{% block type_collection %}

    <div class="type_collection" id="type_collection_{{ field }}">
        {{- echo_twig("form_widget(form['" ~ field ~ "'])") -}}

        {% if builder.Columns[field].formOptions['allow_add'] %}
        <ul class="actions unstyled">
            <li>
                <a class="btn btn-primary new"><i class="icon-plus icon-white"></i> {{ echo_trans('actions.collection.add',{}, i18n_catalog is defined ? i18n_catalog : "Admin") }}</a>
            </li>
        </ul>
        {% endif %}
    </div>

    {% if builder.Columns[field].formOptions['allow_add'] or builder.Columns[field].formOptions['allow_delete'] %}
    <script type="text/javascript">
    $(document).ready(function() {
        {% set field_id = builder.YamlKey ~ '_' ~ builder.ModelClass|lower ~ '_' ~ field %}

        {% if builder.Columns[field].formOptions['allow_add'] %}
        type_collection_{{ field }}_nextId = $('#{{ field_id  }} > div').length;

        $('#type_collection_{{ field }} .new').click(function() {
           var prototype = $('#{{ field_id  }}').data('prototype');
           prototype = prototype.replace(/__name__label__/g, "{{ echo_trans(builder.Columns[field].extras.new_label is defined ? builder.Columns[field].extras.new_label : 'type_collection_' ~ field ~ '_nextId',{}, i18n_catalog is defined ? i18n_catalog : "Admingenerator" ) }}");
           prototype = prototype.replace(/__name__/g, type_collection_{{ field }}_nextId);
           type_collection_{{ field }}_nextId++;
           $('#{{ field_id  }}').append(prototype);

           {% if builder.Columns[field].formOptions['allow_delete'] %}
           $('#{{ field_id  }} > div:last').append("<a class=\"btn delete\"><i class=\"icon-remove\"></i></a>");
           $('#{{ field_id  }} .delete').parent().addClass('input-append');
           
           $('#{{ field_id  }} .delete').click(function() { //@todo make a function for this
               $(this).parent('div').remove();
            });
           {% endif %}
        });
        {% endif %}

        {% if builder.Columns[field].formOptions['allow_delete'] %}
            $('#{{ field_id  }} > div').append("<a class=\"btn delete\"><i class=\"icon-remove\"></i></a>");
            $('#{{ field_id  }} .delete').parent().addClass('input-append');
            
            $('#{{ field_id  }} .delete').click(function() {
               $(this).parent('div').remove();
            });
        {% endif %}
    });
    </script>
    {% endif %}

{% endblock %}
