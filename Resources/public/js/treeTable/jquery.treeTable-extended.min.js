;!function(e){function n(e){for(var n=[];e=o(e);)n[n.length]=e[0];return n}function i(n){return e(n).siblings("tr."+u.childPrefix+n[0].id)}function t(n){return i(n).length?t(i(n).last()):e(n)}function a(e){var n=t(e);return e[0].id===n[0].id?e:e.nextUntil(n).addBack().add(n)}function s(e){return n(e).length*u.indent}function l(n,t){var a=e(n.children("td")[u.treeColumn]);a[0].style.paddingLeft=u.initialIndent+t+"px",i(n).each(function(){l(e(this),t+u.indent)})}function d(n){if(!n.hasClass("initialized")){n.addClass("initialized");var t=-1==n[0].className.search(u.childPrefix),a=i(n),d=a.length>0;if(!n.hasClass("parent")&&d&&n.addClass("parent"),e.isFunction(u.onNodeInit)&&u.onNodeInit.call(this,n,d,t),d&&(l(n,s(n)),u.expandable)){var r=u.clickableElement?n.find(u.clickableElement):n;r.attr("title",u.stringExpand).addClass("expander"),r.on(u.doubleclickMode?"dblclick":"click",function(e){e.preventDefault,n.toggleBranch()}),u.persist&&f(n)&&n.addClass("expanded"),n.hasClass("expanded")||n.hasClass("collapsed")||n.addClass(t?u.initialRootState:u.initialState),n.hasClass("expanded")&&n.expand()}}}function r(n){if(n.hasClass("initialized")){n.removeClass("initialized").removeClass("parent").removeClass("expanded").removeClass("collapsed");var t=-1==n[0].className.search(u.childPrefix),a=i(n),s=a.length>0;if(u.expandable){var l=u.clickableElement?n.find(u.clickableElement):n;l.removeAttr("title").removeClass("expander"),l.off(u.doubleclickMode?"dblclick":"click")}e.isFunction(u.onNodeReinit)&&u.onNodeReinit.call(this,n,s,t),s&&n.addClass("expanded"),d(n)}}function c(e,n,i){if("before"==n&&a(e).insertBefore(i),"after"==n){var s=t(i);a(e).insertAfter(s)}}function o(n){for(var i=n[0].className.split(" "),t=0;t<i.length;t++)if(i[t].match(u.childPrefix))return e(n).siblings("#"+i[t].substring(u.childPrefix.length));return null}function h(e){if(e.hasClass("expanded"))try{x.set(e.attr("id"),"1")}catch(n){}else try{x.remove(e.attr("id"))}catch(n){}}function f(e){try{return"1"==x.get(e.attr("id"))}catch(n){return!1}}var u,p,x;e.fn.treeTable=function(n){return u=e.extend({},e.fn.treeTable.defaults,n),u.persist&&(x=new Persist.Store(u.persistStoreName)),this.each(function(){e(this).addClass("treeTable").find("tbody tr").each(function(){if(!e(this).hasClass("initialized")){var n=-1==e(this)[0].className.search(u.childPrefix);n&&isNaN(p)&&(p=u.initialIndent+parseInt(e(e(this).children("td")[u.treeColumn]).css("padding-left"),10)),!n&&u.expandable&&"collapsed"==u.initialState&&e(this).addClass("ui-helper-hidden"),(!u.expandable||n)&&d(e(this))}})})},e.fn.treeTable.defaults={childPrefix:"child-of-",clickableElement:!1,doubleclickMode:!1,expandable:!0,indent:19,initialIndent:0,initialState:"collapsed",initialRootState:"collapsed",onNodeShow:null,onNodeHide:null,onExpandableInit:null,onNonExpandableInit:null,treeColumn:0,persist:!1,persistStoreName:"treeTable",stringExpand:"Expand",stringCollapse:"Collapse"},e.fn.expandAll=function(){e(this).find("tr").each(function(){e(this).expand()})},e.fn.collapseAll=function(){e(this).find("tr").each(function(){e(this).collapse()})},e.fn.collapse=function(){return this.each(function(){e(this).removeClass("expanded").addClass("collapsed"),u.persist&&h(e(this)),i(e(this)).each(function(){e(this).hasClass("collapsed")||e(this).collapse(),e(this).addClass("ui-helper-hidden"),e.isFunction(u.onNodeHide)&&u.onNodeHide.call(this)})})},e.fn.expand=function(){return this.each(function(){e(this).removeClass("collapsed").addClass("expanded"),u.persist&&h(e(this)),i(e(this)).each(function(){d(e(this)),e(this).is(".expanded.parent")&&e(this).expand(),e(this).removeClass("ui-helper-hidden"),e.isFunction(u.onNodeShow)&&u.onNodeShow.call(this)})})},e.fn.reveal=function(){return e(n(e(this)).reverse()).each(function(){d(e(this)),e(this).expand().show()}),this},e.fn.appendBranchTo=function(i){var t=e(this),a=o(t),s=e(i),d=e.map(n(s),function(e){return e.id});return-1!=e.inArray(t[0].id,d)||a&&s.id==a[0].id||s.id==t[0].id||(c(t,"after",s),a&&t.removeClass(u.childPrefix+a[0].id),t.addClass(u.childPrefix+s[0].id),l(t,n(t).length*u.indent)),this},e.fn.moveBranch=function(i,t){if("in"==i)return void e(this).appendBranchTo(t);if(-1!=e.inArray(i,["before","after"])){var a=e(this),s=o(a),d=e(t),r=o(d),h=e.map(n(d),function(e){return e.id});return-1==e.inArray(a[0].id,h)&&d[0].id!=a[0].id&&(c(a,i,d),s&&a.removeClass(u.childPrefix+s[0].id),r&&a.addClass(u.childPrefix+r[0].id),l(a,n(a).length*u.indent)),this}},e.fn.reverse=function(){return this.pushStack(this.get().reverse(),arguments)},e.fn.toggleBranch=function(){return e(this).hasClass("collapsed")?e(this).expand():e(this).collapse(),this},e.fn.nodeParent=function(){var n=e(this),i=n[0].className.match(new RegExp(u.childPrefix+"[^\\s]+","i"));return i?e("#node-"+i[0].substring(14)):null},e.fn.nodeReinitialize=function(){return r(e(this)),this},e.fn.selectBranch=function(){return a(this)},e.fn.branchLast=function(){return t(this)}}(jQuery);